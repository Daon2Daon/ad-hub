# 프로젝트 개요
- 프로젝트명: 광고주 데이터 관리 시스템 (Ver 1.1)
- 목표: 광고주의 광고 집행 현황, 비용, 스케줄을 중앙에서 관리하고 리포팅하는 웹 서비스 구축 (MVP+)
- 기술 스택 (권장): Next.js, TypeScript, Next-Auth (인증), Zustand/Recoil (상태관리), SWR/React-Query (데이터 페칭), PostgreSQL/MySQL (DB), Prisma (ORM)

# 1. 글로벌 및 공통 요구사항
## 1.1. 사용자 역할 (Roles)
- Admin: 모든 기능 접근 가능. '마스터 데이터', '활동 로그', '시스템 관리' 메뉴 접근 가능.
- User (일반 사용자): '마스터 데이터', '활동 로그', '시스템 관리' 메뉴 접근 불가. Admin이 설정한 데이터 접근 권한에 따라 화면(대시보드, 리포트 등)의 데이터가 필터링되어 노출됨.

## 1.2. 데이터 접근 제어 (Permission) - (중요 변경)
- 본 시스템은 두 가지 유형의 권한을 동시에 제어해야 합니다.
- 컬럼(Column) 레벨 보안 (기존 요청): '시스템 관리'에서 설정된 '권한'에 따라 특정 데이터 필드(컬럼)가 보이지 않아야 합니다. (예: '광고비' 권한이 없으면 '광고비' 컬럼 자체가 마스킹 처리됨)
- 행(Row) 레벨 보안 (제안 2 반영): '시스템 관리'에서 사용자에게 할당된 '담당부서', '대행사' 등의 값(Scope)에 따라, 해당 사용자에게는 그 값이 일치하는 데이터(행)만 노출되어야 합니다. (예: 'A부서'로 할당된 사용자는 'A부서'의 광고 데이터만 조회 가능)
- 적용 범위: 대시보드, 매체 스케쥴, 광고집행 관리, 리포트 등 모든 데이터 노출 영역.

## 1.3. MVP 테스트 계정
- admin (pw: admin123) / Role: Admin
- user (pw: user123) / Role: User (테스트를 위해 '광고비', '예산계정' 접근 권한(컬럼)을 제거하고, '특정 부서'의 데이터(행)만 볼 수 있도록 설정)

# 2. 페이지별 기능 명세
## 2.1. 인증 (Auth)
### 경로: 
- /login, /signup
### 로그인 (/login):
- 아이디, 비밀번호 필드
- 로그인 성공 시 /dashboard로 리디렉션
### 가입 신청 (/signup):
- 아이디, 비밀번호 필드
- 제출 시 Users 테이블에 status: 'pending' (승인 대기) 상태로 저장
### 라우트 가드 (Route Guard):
- /login, /signup을 제외한 모든 페이지는 인증된 사용자만 접근 가능해야 합니다.

## 2.2. 대시보드 (Dashboard)
### 경로: 
- /dashboard (로그인 후 기본 페이지)
### 기간 필터:
- 기본 노출: 오늘 날짜 기준 '이번달' 및 '올해' 누적 데이터를 기본으로 로드합니다.
- 커스텀 조회: '날짜 범위 선택(Date Range Picker)' 기능을 제공하여 사용자가 원하는 기간의 데이터를 조회할 수 있도록 합니다.
### 컴포넌트:
- 핵심 지표 (KPI Cards): '집행중인 광고 (건)', '선택 기간 광고비 (원)', '올해 누적 광고비 (원)'
- 도넛 차트 1: '선택 기간 소재별 광고 비중'
- 도넛 차트 2: '선택 기간 대행사별 광고 비중'
### 데이터: 모든 데이터는 사용자의 접근 권한(1.2항 - 컬럼 및 행 레벨)에 따라 완벽히 필터링되어야 합니다.

## 2.3. 매체 스케쥴 (Schedule)
### 경로:
- /schedule
### 컴포넌트:
- 뷰 토글 (View Toggle): '간트 차트', '캘린더' 2가지 뷰 제공
- 간트 차트 (Gantt View) 및 캘린더 (Calendar View)
### 기능:
- '신규 등록' 버튼
- '신규 등록' 버튼 클릭 시, 페이지 이동이 아닌 현재 페이지에서 모달(Modal) 창을 띄워 간편 등록을 지원합니다.

## 2.4. 광고집행 관리 (Management)
### 경로: 
- /management
### 핵심 컴포넌트: 
- 데이터 그리드 (테이블)
### 데이터 컬럼:
- 캠페인, 소재, 매체, 일정(시작/종료), 광고비, 예산계정, 담당부서, 대행사
### 입력 방식:
- '캠페인', '소재', '매체', '예산계정', '담당부서', '대행사' 필드는 텍스트 직접 입력이 아닌, '마스터 데이터 관리' 메뉴(3항 참고)에 등록된 값을 선택하는 드롭다운(Select Box) 형태여야 합니다.
### 기능:
- 신규 등록: (모달 또는 별도 페이지)
- 데이터 수정/삭제: (그리드 내에서 직접 또는 상세 페이지)
- 엑셀 업로드/템플릿 다운로드: (기존 유지)
- 일괄 작업 : 데이터 그리드 각 행(Row)마다 체크박스를 제공합니다. 사용자가 여러 항목을 선택한 뒤, 상단의 '일괄 변경' 또는 '일괄 삭제' 버튼을 통해 동시에 데이터를 수정(예: A부서 -> B부서로 일괄 이동)하거나 삭제할 수 있어야 합니다.

## 2.5. 리포트 (Report)
### 경로:
- /report
### 컴포넌트:
- 조회 필터: 시작일 / 종료일 (Date Range Picker). 다중 선택 드롭다운: 캠페인, 소재, 매체, 담당부서, 대행사, 예산계정 (모두 '마스터 데이터' 기반).
### 조회 결과:
- 필터링된 데이터 그리드 (테이블). 조회 결과 '총 광고비'.
### 기능:
- '조회' 버튼
- '엑셀 다운로드' 버튼
### 데이터: 조회 결과는 반드시 사용자의 접근 권한(1.2항 - 컬럼 및 행 레벨)에 따라 이중 필터링되어야 합니다.

# 3. 마스터 데이터 관리 (Admin 전용) - (신규)
### 경로:
- /masterdata (Admin Role만 메뉴 노출 및 접근 가능)
- 데이터의 일관성 및 무결성 확보를 위한 메뉴입니다.
- 기능: '광고집행 관리'에서 사용하는 주요 분류 항목을 미리 등록하고 관리합니다.
### 하위 메뉴 (CRUD 제공):
- 캠페인 관리
- 소재 관리
- 매체 관리
- 예산계정 관리
- 담당부서 관리
- 대행사 관리

# 4. 활동 로그 (Admin 전용) - (신규)
### 경로:
- /logs (Admin Role만 메뉴 노출 및 접근 가능)
- 시스템의 주요 변경 이력을 추적하기 위한 메뉴입니다.
- 기능: 모든 사용자의 주요 활동을 시간순으로 기록(Logging)하고 조회합니다.
### 로그 항목:
- 로그인 (성공/실패)
- 데이터 생성 (예: 신규 광고 집행 등록)
- 데이터 수정 (예: 광고비 변경)
- 데이터 삭제
- 엑셀 업로드
- 로그 형식: [타임스탬프] - [사용자 ID] - [작업 유형] - [작업 상세 내용]

# 5. 시스템 관리 (Admin 전용)
### 경로:
- /system (Admin Role만 메뉴 노출 및 접근 가능)
## 컴포넌트 (Tabs 또는 Sub-menu):
### 비밀번호 변경 (모든 사용자 공통):
- (경로 변경 제안: /mypage 등 일반 사용자가 접근 가능한 곳으로 이동)
- 기능: 현재 비밀번호, 새 비밀번호, 새 비밀번호 확인 (자신의 것만 변경)
### 사용자 관리 (Admin Role만 노출):
- 가입 승인 목록 (Tab 1): status: 'pending'인 사용자 리스트. '승인', '거절' 버튼 제공.
- 전체 사용자 목록 (Tab 2): status: 'active'인 사용자 리스트.
- 비밀번호 재설정 (제안 4 변형 반영): Admin은 사용자가 비밀번호를 분실한 경우, 해당 사용자의 비밀번호를 강제로 초기화(재설정)할 수 있는 기능을 제공해야 합니다.
- 권한 설정 (Action): 각 사용자별 '권한 설정' 버튼 제공.
## '권한 설정' 기능 (Modal 또는 Page):
- 선택된 사용자의 아이디 표시
### (1) 데이터 스코프 할당 (제안 2 반영):
- 이 사용자가 조회할 수 있는 '담당부서' (드롭다운, 마스터 데이터 연동)
- 이 사용자가 조회할 수 있는 '대행사' (드롭다운, 마스터 데이터 연동)
### (2) 컬럼 접근 권한 (기존 요청):
- [ ] 캠페인
- [ ] 소재
- [ ] 매체
- [ ] 일정(기간)
- [ ] 광고비
- [ ] 예산계정
- [ ] 담당부서
- [ ] 대행사

# 개발 구현 계획
- **Phase 0 – 프로젝트 초기화:** Next.js(App Router)와 TypeScript 기반 프로젝트 초기 세팅, ESLint/Prettier/Tailwind/Shadcn UI 구성, 디렉터리 구조 수립, 공통 타입 및 환경 변수 검증 스켈레톤 마련.
- **Phase 1 – 인증 및 권한 토대:** `/login`, `/signup` 페이지와 라우트 가드 구현, 인증 로직 구축, 기본 Role(Admin/User)과 세션 컨텍스트 설정, 접근 불가 페이지 리다이렉션 처리.
- **Phase 2 – 권한 스코프/컬럼 보안 인프라:** 컬럼 권한 및 행(Row) 레벨 스코프 모델링, Zod 스키마 구성, 사용자 권한에 따른 데이터 필터링 유틸리티 구축.
- **Phase 3 – 대시보드 기본 기능:** `/dashboard` 골격 구성, KPI 카드와 도넛 차트 2종 구현, 기본 기간 데이터와 Date Range Picker 제공, 권한 기반 데이터 마스킹 적용.
- **Phase 4 – 매체 스케줄:** `/schedule` 페이지에 간트/캘린더 뷰 토글 구현, 신규 등록 모달 및 폼 검증, 권한 기반 행 필터링 재사용.
- **Phase 5 – 광고집행 관리:** `/management` 테이블 구축, 마스터 데이터 드롭다운 연동, CRUD/일괄 작업/엑셀 업로드 기능 구현, 컬럼 권한 마스킹과 행 필터링 적용.
- **Phase 6 – 리포트 페이지:** `/report` 조회 필터와 결과 그리드 구현, 총 광고비 계산, 엑셀 다운로드 기능, 데이터 캐싱 전략 검토.
- **Phase 7 – 마스터 데이터 관리:** `/masterdata` 하위 CRUD 화면(캠페인/소재/매체/예산계정/담당부서/대행사) 구현, 서버 액션(next-safe-action) 및 데이터 무결성 검증 로직 추가.
- **Phase 8 – 활동 로그 시스템:** `/logs` 페이지에서 주요 이벤트 로깅 및 조회 UI 제공, 로그인/CRUD/엑셀 업로드 이벤트 기록 스키마 정의, 필터/페이지네이션 고려.
- **Phase 9 – 시스템 관리:** `/system` 탭 구조 구축, 비밀번호 변경(일반)과 사용자 관리(Admin) 기능(가입 승인/거절, 비밀번호 초기화, 권한 설정 모달) 구현.
- **Phase 10 – 품질 보강:** Vitest/RTL 테스트, 접근성 점검, 성능 최적화(Suspense, next/image 등), 문서화 보강 및 배포 자동화 준비.

## 개발 환경 준비
- `.env.example`를 참고해 실제 `DATABASE_URL`, `NEXTAUTH_SECRET`, `SEED_ADMIN_LOGIN_ID` 등 환경변수를 `.env`에 설정합니다.
- Prisma 마이그레이션 SQL은 `prisma/migrations/20241109_init/migration.sql`, `prisma/migrations/20241109_login_id/migration.sql`에 생성되어 있습니다. 로컬 DB에 적용하려면:
  - `npx prisma migrate deploy` 또는 `psql` 등으로 SQL을 실행
  - 마이그레이션 완료 후 `npm run prisma:generate`로 클라이언트 재생성
- 초기 관리자 및 샘플 캠페인 데이터는 `npm run prisma:seed`로 주입할 수 있습니다. (기본 관리자 아이디/비밀번호는 `.env`의 `SEED_ADMIN_LOGIN_ID`, `SEED_ADMIN_PASSWORD`를 참조)
- 개발 서버 실행 전 `npm run typecheck`, `npm run lint`로 기본 검증을 수행하세요.